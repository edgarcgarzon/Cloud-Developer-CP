service: keep-lite

plugins:
  - serverless-webpack
  - serverless-iam-roles-per-function
  - serverless-dynamodb-local
  - serverless-offline

provider:
  name: aws
  runtime: nodejs14.x

  stage: ${opt:stage, 'dev'}
  region: ${opt:region, 'eu-central-1'}

  tracing:
    lambda: true
    apiGateway: true

  environment:
    AWS_NODEJS_CONNECTION_REUSE_ENABLED: 1
    NOTE_LITE_TABLE: NOTE_LITE_TABLE-${self:provider.stage}

  apiGateway:
    minimumCompressionSize: 1024,
    shouldStartNameWithService: true
  
  lambdaHashingVersion: '20201221'

functions:

  Auth:
    handler: src/functions/auth/auth0Authorizer.main
  
  Hello:
    handler: src/functions/http/hello/handler.main
    events:
      - http:
          method: post
          path: hello
          cors: true
          authorizer: Auth
          request:
            schema:
              application/json: ${file(src/functions/http/hello/holaSchema.json)}

  GetNote:
    handler: src/functions/http/getNoteReq/getNoteReq.main
    events:
      - http:
          method: get
          path: note
          cors: true
          authorizer: Auth
          request:
            parameters:
              querystrings:
                label: true
  
  postNote:
    handler: src/functions/http/postNoteReq/postNoteReq.main
    events:
      - http:
          method: post
          path: note
          cors: true
          authorizer: Auth
          request:
            schema:
              application/json: ${file(src/functions/http/postNoteReq/postNoteReqSch.json)
  
custom:
  webpack:
    webpackConfig: ./webpack.config.js
    includeModules: true
  
  serverless-offline:
    port: 3030
  
  
  dynamodb:
    stages:
      - ${self:provider.stage}
    start:
      port: 8000
      inMemory: true
      migrate: true



